<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Résultats — Skull King</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e3a8a">
<style>
  :root{--card:rgba(255,255,255,0.06);--white:#eef2ff;--muted:#9ca3af;--gold:#ffd54a;--silver:#c0c6cc;--bronze:#d9a066}
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;background:linear-gradient(180deg,#041226,#071430) fixed;
    background-repeat:no-repeat;background-size:cover;background-position:center;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--white);padding:14px;display:flex;align-items:center;justify-content:center
  }
  .wrap{width:100%;max-width:780px}
  .card{background:var(--card);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,0.08)}
  h2{margin:0 0 8px}
  .muted{color:var(--muted);font-size:13px}
  .list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
  .item{padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);opacity:0.05;transform:translateY(10px)}
  .item.visible{opacity:1;transform:translateY(0);transition:all 360ms cubic-bezier(.2,.9,.3,1)}
  .line{display:flex;justify-content:space-between;align-items:center}
  .name{font-weight:900}
  .score{font-size:22px}
  .gold{background:linear-gradient(90deg,#fff3c4,#ffd54a);color:#111}
  .silver{background:linear-gradient(90deg,#eef0f2,#c0c6cc);color:#111}
  .bronze{background:linear-gradient(90deg,#fde9d6,#d9a066);color:#111}
  .controls{display:flex;justify-content:center;gap:10px;margin-top:14px}
  .btn{padding:12px;border-radius:12px;border:0;background:#0ea5e9;color:#021026;font-weight:900;cursor:pointer}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Résultats finaux</h2>
        <div class="muted">Tape l’écran pour révéler du dernier au premier</div>
      </div>

      <div id="list" class="list"></div>

      <div id="controls" class="controls" style="display:none">
        <button class="btn" onclick="location.href='create.html'">Refaire une partie</button>
        <button class="btn" onclick="location.href='leaderboard.html'">Leaderboard</button>
      </div>
    </div>
  </div>

<script>
const LS_GAME = 'skullking_game_v4';
const game = JSON.parse(localStorage.getItem(LS_GAME) || 'null');
if (!game || !game.players){ alert('Aucune partie.'); location.href='create.html'; }

const list = document.getElementById('list');
const controls = document.getElementById('controls');

// tri du + grand au + petit POUR L'AFFICHAGE (meilleur en haut)
const sorted = game.players.slice().sort((a,b)=> b.score - a.score);

// construire la liste (tous cachés)
const items = sorted.map((p, idx)=>{
  const div = document.createElement('div');
  div.className='item';
  const name = esc(p.name);
  div.innerHTML = `<div class="line"><div class="name">${name}</div><div class="score">???</div></div>`;
  list.appendChild(div);
  return {el:div, data:p, idx};
});

// ordre de révélation = du dernier (score le plus bas) au premier
let revealIndex = items.length - 1; // commence par le bas visuellement
function revealNext(){
  if (revealIndex < 0){ return; }
  const it = items[revealIndex];
  it.el.querySelector('.score').textContent = String(it.data.score);
  // médailles pour top 3 (indices 0,1,2 car tri desc)
  if (it.idx === 0) it.el.classList.add('gold');
  else if (it.idx === 1) it.el.classList.add('silver');
  else if (it.idx === 2) it.el.classList.add('bronze');
  it.el.classList.add('visible');
  revealIndex--;
  if (revealIndex < 0){ controls.style.display='flex'; }
}

document.addEventListener('click', revealNext, {passive:true});
document.addEventListener('touchstart', revealNext, {passive:true});

function esc(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
</script>
</body>
</html>
