<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Créer une partie — PirateFx</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e3a8a">
<style>
  :root{--card:rgba(255,255,255,0.06);--accent:#0ea5e9;--muted:#9ca3af;--white:#eef2ff}
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;
    /* Remplace la ligne ci-dessous par: background-image:url('ton-fond.jpg'); si tu veux une image */
    background:linear-gradient(180deg,#041226,#071430) fixed;
    background-repeat:no-repeat;background-size:cover;background-position:center;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--white);padding:16px
  }
  .wrap{max-width:720px;margin:0 auto}
  .card{background:var(--card);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,0.08)}
  h2{margin:0 0 8px;font-size:18px} .small{font-size:13px;color:var(--muted)}
  .players{margin-top:12px;display:flex;flex-direction:column;gap:10px}
  .row{display:flex;gap:8px}
  .row input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:var(--white)}
  .btn{padding:12px;border-radius:12px;border:0;background:var(--accent);color:#021026;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.12);color:var(--white)}
  .add-full{margin-top:8px;display:block;width:100%;text-align:center}
  .actions{display:flex;gap:8px;margin-top:12px}
  .btn.add-full {display:block;width:100%;padding:12px;border-radius:12px;border:2px dashed rgba(255,255,255,0.08);background:transparent;color:var(--accent);font-weight:800;cursor:pointer;}
  .btn.add-full:hover { background: rgba(255,255,255,0.02); }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Créer une partie</h2>
      <div class="small">Ajoute les joueurs (minimum 2).</div>

      <div class="players" id="players"></div>
      <button id="addBtn" class="btn add-full">+ Ajouter un joueur</button>

      <div class="actions">
        <button id="startBtn" class="btn">Démarrer</button>
        <button class="btn ghost" onclick="location.href='index.html'">Annuler</button>
      </div>
    </div>
  </div>

<script>
/* Config */
const DECK_SIZE = 66; // ← modifie si besoin
const LS_GAME = 'skullking_game_v0.21';

const playersEl = document.getElementById('players');
const addBtn = document.getElementById('addBtn');
const startBtn = document.getElementById('startBtn');

let players = [];

// helper : active/desactive start si doublon ou nom vide
function checkStartEnabled(){
  const names = players.map(p => (p.name || '').trim());
  const hasEmpty = names.some(n => n === '');
  // detect duplicates (case-insensitive)
  const lowered = names.map(n => n.toLowerCase());
  const hasDup = lowered.some((n,i) => n && lowered.indexOf(n) !== i);
  // disable start if empty or duplicate
  startBtn.disabled = hasEmpty || hasDup;
  startBtn.classList.toggle('disabled', startBtn.disabled);
  // optionally show hint
  let hint = document.getElementById('createHint');
  if (!hint){
    hint = document.createElement('div'); hint.id = 'createHint'; hint.style.marginTop='8px'; hint.style.color='lightyellow';
    document.querySelector('.card').appendChild(hint);
  }
  if (hasEmpty) hint.textContent = 'Noms vides détectés — remplis tous les noms.';
  else if (hasDup) hint.textContent = 'Deux joueurs ont le même nom — renomme l’un d’eux.';
  else hint.textContent = '';
}

function addPlayer(name=''){
  const id = 'p_'+Math.random().toString(36).slice(2,8);
  players.push({id, name: name || ''});
  render();
}
function removePlayer(id){
  if (players.length<=2) return;
  players = players.filter(p=>p.id!==id);
  render();
}
function render(){
  playersEl.innerHTML = '';
  players.forEach((p,i)=>{
    const row = document.createElement('div'); row.className='row';
    const input = document.createElement('input'); input.placeholder='Nom du joueur'; input.value=p.name;
    input.addEventListener('input', e=>{ p.name = e.target.value; checkStartEnabled(); });
    const minus = document.createElement('button'); minus.className='btn ghost'; minus.textContent='−';
    minus.disabled = players.length<=2;
    minus.title = 'Supprimer';
    minus.addEventListener('click', ()=> removePlayer(p.id));
    row.appendChild(input); row.appendChild(minus);
    playersEl.appendChild(row);
  });
  // after render, check start
  checkStartEnabled();
}
addPlayer('Joueur 1'); addPlayer('Joueur 2');

addBtn.addEventListener('click', ()=> addPlayer());

startBtn.addEventListener('click', ()=>{
  const final = players.map(p=>({id:p.id, name:(p.name||'Joueur').trim(), score:0}));
  if (final.filter(p=>p.name).length < 2){ alert('Ajoute au moins 2 joueurs.'); return; }
  // safety: re-check duplicates before starting
  const names = final.map(p=>p.name.toLowerCase());
  const dup = names.some((n,i)=> n && names.indexOf(n)!==i);
  if (dup) { alert('Renomme les joueurs pour qu\'ils soient uniques.'); return; }
  const totalRounds = Math.min(10, Math.floor(DECK_SIZE / Math.max(1, final.length)));
  const game = { players:final, currentRound:1, totalRounds, subphase:'bids', savedBids:{} };
  localStorage.setItem(LS_GAME, JSON.stringify(game));
  location.href='game.html';
});
</script>
</body>
</html>
